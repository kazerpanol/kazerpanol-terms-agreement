<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice-Highlight Terms with Volume Circle</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 0;
}

.card {
  max-width: 500px;
  margin: 50px auto;
  padding: 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

h2 {
  margin-top: 0;
}

.instruction {
  font-size: 14px;
  color: #444;
  margin-bottom: 10px;
}

#volumeMeter {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 15px;
}

#volumeCircle {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #ffd966;
  transform: scale(0);
  transition: transform 0.05s linear;
}

.read-zone {
  margin: 15px 0;
  padding: 15px;
  background: #ffffff;
  border-left: 4px solid #ffb700;
  border-radius: 6px;
}

.word {
  padding: 2px 2px;
  margin: 0 2px;
  display: inline-block;
  background-color: #f0f0f0; /* not-read */
  border-radius: 3px;
}

.word.read {
  background-color: #ffd966; /* highlighted word */
}

button {
  margin-top: 10px;
  padding: 10px 14px;
  background: #007bff;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  width: 100%;
  font-size: 16px;
}

button:disabled {
  background: #aaa;
  cursor: not-allowed;
}

.agree {
  display: block;
  margin-top: 20px;
  font-size: 14px;
}
</style>
</head>
<body>

<div class="card">
  <h2>Terms & Agreement</h2>
  <p class="instruction">Please read aloud. Spoken words will be highlighted in real-time.</p>

  <!-- Volume Circle -->
  <div id="volumeMeter">
    <div id="volumeCircle"></div>
  </div>

  <div class="read-zone" id="readZone"></div>

  <button id="startBtn">ðŸŽ¤ Start Reading</button>

  <label class="agree">
    <input type="checkbox" id="agree" disabled />
    I have read and understood the Terms & Conditions
  </label>
</div>

<script>
// Terms text
const text = `By using this service, you agree that your personal data may be collected, processed, and stored in accordance with our Privacy Policy and Terms.`;

// Split text into words and display
const readZone = document.getElementById("readZone");
const words = text.split(" ");
words.forEach((word, i) => {
  const span = document.createElement("span");
  span.textContent = word + " ";
  span.className = "word";
  span.id = "word-" + i;
  readZone.appendChild(span);
});

const startBtn = document.getElementById("startBtn");
const checkbox = document.getElementById("agree");
const volumeCircle = document.getElementById("volumeCircle");

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
  startBtn.disabled = true;
  alert("Your browser does not support Speech Recognition. Use Chrome on Android or Desktop.");
}

let recognition;
let audioContext, analyser, microphone, dataArray;

startBtn.addEventListener("click", async () => {
  startBtn.disabled = true;

  // --- Speech recognition ---
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = 'en-US';

  recognition.onresult = (event) => {
    const transcript = Array.from(event.results)
      .map(r => r[0].transcript)
      .join(" ")
      .toLowerCase()
      .replace(/[^a-zA-Z ]/g, "");

    // Highlight words if they appear anywhere in transcript
    words.forEach((word, i) => {
      const cleanWord = word.replace(/[^a-zA-Z]/g, "").toLowerCase();
      const span = document.getElementById("word-" + i);
      if (transcript.includes(cleanWord)) {
        span.classList.add("read");
      }
    });

    // Unlock checkbox
    const allRead = words.every((_, i) => document.getElementById("word-" + i).classList.contains("read"));
    if (allRead) {
      checkbox.disabled = false;
      recognition.stop();
    }
  };

  recognition.onerror = (e) => {
    console.error(e);
    alert("Speech recognition error. Make sure your microphone is allowed.");
  };

  recognition.start()
