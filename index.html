<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Voice-Controlled Slider</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    text-align: center;
    padding: 50px;
    background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #a18cd1, #fbc2eb);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  h1 { color: #fff; text-shadow: 1px 1px 5px rgba(0,0,0,0.3); }

  #slider {
    width: 80%;
    margin: 30px 0;
    height: 15px;
    -webkit-appearance: none;
    background: #ddd;
    border-radius: 10px;
    transition: background 0.3s;
  }

  #slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 25px;
    height: 25px;
    background: #ff6f61;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.2s, background 0.3s;
  }

  #slider::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    background: #ff3b2e;
  }

  button {
    padding: 12px 25px;
    font-size: 16px;
    margin: 5px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #ff6f61;
    color: #fff;
    transition: transform 0.2s, background 0.3s;
  }

  button:hover {
    transform: scale(1.1);
    background: #ff3b2e;
  }

  #savedValue { font-weight: bold; color: #00ff88; margin-top: 15px; }

  #value {
    font-weight: bold;
    color: #fff;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
  }

</style>
</head>
<body>

<h1>Voice-Controlled Slider</h1>

<input type="range" id="slider" min="0" max="100" value="50">
<p>Slider value: <span id="value">50</span>%</p>

<button id="setBtn">Set Volume</button>
<button id="saveBtn">Save Value</button>

<p id="savedValue"></p>

<script>
let audioContext;
let analyser;
let microphone;
let dataArray;
let slider = document.getElementById('slider');
let valueDisplay = document.getElementById('value');
let savedDisplay = document.getElementById('savedValue');
let running = false;
let animationId = null;

// Update slider based on microphone volume
function updateSlider() {
    analyser.getByteTimeDomainData(dataArray);
    let sum = 0;
    for(let i=0; i<dataArray.length; i++){
        let val = (dataArray[i] - 128)/128;
        sum += val * val;
    }
    let rms = Math.sqrt(sum / dataArray.length);
    let sliderValue = Math.min(100, Math.max(0, Math.floor(rms * 500)));
    slider.value = sliderValue;
    valueDisplay.textContent = sliderValue;

    animationId = requestAnimationFrame(updateSlider);
}

// Start/resume listening and slider movement
async function startListening() {
    if (running) return;
    running = true;

    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        microphone = audioContext.createMediaStreamSource(stream);

        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);

        microphone.connect(analyser);
    } else if (audioContext.state === 'suspended') {
        await audioContext.resume();
    }

    updateSlider();
}

// Stop slider updates
function stopSlider() {
    if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
    }
    running = false;
}

// Event listeners
document.getElementById('setBtn').addEventListener('click', () => {
    startListening();
});

document.getElementById('saveBtn').addEventListener('click', () => {
    stopSlider(); // Stop slider movement
    let savedValue = slider.value;
    savedDisplay.textContent = `Saved value: ${savedValue}% âœ…`;
});
</script>

</body>
</html>
